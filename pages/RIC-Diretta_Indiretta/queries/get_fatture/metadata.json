{
  "gitSyncId": "6601851cbf3e805bd6a4b13a_a553402e-8e52-45b7-b2f4-f63ba0e52977",
  "id": "RIC-Diretta_Indiretta_get_fatture",
  "pluginId": "mssql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT TOP 100\n    I.INMYCOMPANYID,\n    I.ININVOICEID,\n    I.INPURPOSEID,\n    I.INDOCUMENTTYPE,\n    I.INCUSTOMERDESCRIPTION,\n    I.INTAXYEAR,\n    I.ININVOICENUMBER,\n    I.ININVOICEDATE,\n    MAX(D.INHOSPITALIZATIONID) as INHOSPITALIZATIONID,\n    MAX(H.HOLASTNAME) as HOLASTNAME,\n    MAX(H.HOHOSPCOUNTER) as HOHOSPCOUNTER, \n    MAX(P.DPPURPOSEDESCRIPTION) as DPPURPOSEDESCRIPTION\n\nFROM ba_invoice_m I\nLEFT JOIN ba_document_purpose P ON I.INPURPOSEID = P.DPPURPOSEID\nLEFT JOIN ba_invoice D ON I.ININVOICEID = D.ININVOICEID\nLEFT JOIN ba_hospitalization H ON D.INHOSPITALIZATIONID = H.HOHOSPID\n\nWHERE I.INDOCUMENTTYPE IN ('FA', 'NC')\n  AND (I.ININVOICESET IS NULL OR I.ININVOICESET = '')\n\n  -- *** QUESTA È LA PARTE CHE RISOLVE IL TUO PROBLEMA ***\n  AND (\n        -- Cerca per CF: usa l'anno DELLA FATTURA, non della cartella\n       (\n           I.INCUFISCALCODE = '{{Input_CF.text}}' \n           AND '{{Input_CF.text}}' != ''\n           AND ('{{Input_Anno.text}}' = '' OR I.INTAXYEAR = '{{Input_Anno.text}}')\n       )\n       OR \n       \n       -- Cerca per Cartella solo se NON è vuota E controlla anche l'anno della cartella\n       (\n           H.HOHOSPCOUNTER = '{{Input_Cartella.text}}' \n           AND '{{Input_Cartella.text}}' != ''\n           -- NUOVA RIGHE AGGIUNTE QUI SOTTO:\n           AND H.HOHOSPYEAR = '{{Input_Anno.text}}'\n       )\n  )\n\n  -- Filtro Anno (Opzionale per le fatture generali)\n  AND (\n       '{{Input_Anno.text}}' = '' \n       OR \n       I.INTAXYEAR = '{{Input_Anno.text}}'\n  )\n\nGROUP BY \n    I.INMYCOMPANYID,\n    I.ININVOICEID,\n    I.INPURPOSEID,\n    I.INDOCUMENTTYPE,\n    I.INCUSTOMERDESCRIPTION,\n    I.INTAXYEAR,\n    I.ININVOICENUMBER,\n    I.ININVOICEDATE\n\nORDER BY I.ININVOICEDATE DESC;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "TEST_PAIDEIA",
      "isAutoGenerated": false,
      "name": "TEST_PAIDEIA",
      "pluginId": "mssql-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "get_fatture",
    "pageId": "RIC-Diretta_Indiretta",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": true
  }
}